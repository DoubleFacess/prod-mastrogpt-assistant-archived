!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NuvolarisAssistant=e():t.NuvolarisAssistant=e()}(self,(()=>(()=>{"use strict";var t={71:(t,e,o)=>{o.d(e,{A:()=>r});var n=o(601),s=o.n(n),i=o(314),a=o.n(i)()(s());a.push([t.id,":host{bottom:25px;display:block;font-family:var(--font-family,Roboto,Helvetica,Arial,sans-serif);font-size:var(--font-size-root,100%);font-weight:var(--font-weight-bold,400);line-height:var(--line-height,1.75rem);position:fixed;right:25px;z-index:9999}.clearfix{margin-bottom:2px;margin-top:2px}.icon{fill:#fff}button{background-color:#0070f3;border:none;border-radius:50%;color:#fff;cursor:pointer;height:60px;padding:10px;transition:background-color .3s;width:60px}button:hover{background-color:#0051bb}.close-btn{align-items:center;background-color:#ccc;border:none;border-radius:50%;cursor:pointer;display:flex;height:20px;justify-content:center;position:absolute;right:10px;top:10px;width:20px}.close-btn:hover{background-color:#aaa}.chat-log{border-bottom:1px solid #ccc;flex-grow:1;overflow-y:auto;padding:10px}.chat-log .message{margin-bottom:10px}.chat-log .message.user,.userMsg{color:#000}.userMsg{word-wrap:break-word;animation:animateElement .2s linear;animation-iteration-count:1;background:#fff;border-radius:20px 0 20px 20px;box-shadow:0 2px 5px 0 #9a828454;float:right;font-size:13px;margin-bottom:.15em;margin-right:.5em;margin-top:5px;max-width:65%;min-width:15%;padding:10px}.chat-log .message.assistant{color:#0070f3}.chat-log .message.assistant-thinking{color:#0070f3;font-style:italic}.chat-input{background-color:#f7f7f7;border-bottom-left-radius:8px;border-bottom-right-radius:8px;display:flex;padding:5px}.chat-input input{border:1px solid #ccc;border-radius:5px;flex-grow:1;font-size:14px;padding:5px 10px}.chat-input button{font-size:14px;margin-left:5px;padding:5px 10px}.send-btn{background-color:#0070f3;border:none;border-radius:5px;color:#fff;cursor:pointer;font-size:14px;padding:5px 15px;transition:background-color .3s}.send-btn[disabled]{background-color:#b3b3b3;cursor:not-allowed}.send-btn:hover{background-color:#0051bb}.chat-window{background-color:#fff;border:1px solid #ccc;border-radius:10px 10px 10px 10px;bottom:80px;box-shadow:0 2px 10px 1px #b5b5b5;box-shadow:0 2px 10px rgba(0,0,0,.1);flex-direction:column;height:500px;position:absolute;right:0;width:350px}.chat_header{background:#1da1ce;border-radius:10px 10px 0 0;font-size:20px;height:60px;padding:5px}.chat_header_title{color:#fff;margin-left:auto;margin-right:auto}",""]);const r=a},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o="",n=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),n&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),n&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o})).join("")},e.i=function(t,o,n,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var r=0;r<this.length;r++){var d=this[r][0];null!=d&&(a[d]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);n&&a[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),o&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=o):l[2]=o),s&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=s):l[4]="".concat(s)),e.push(l))}},e}},601:t=>{t.exports=function(t){return t[1]}}},e={};function o(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};return(()=>{function t(t){return!!document.getElementById(t)&&document.getElementById(t)}function e(t){return!!document.querySelector(t)&&document.querySelector(t)}o.d(n,{default:()=>d});const s={TITLE:"Nuvolaris OpenChat Assistant",WC_TAG_NAME:"my-widget",TOKEN_LIMIT:1e3,SPECIAL_TOKEN_BUFFER:10,YOUR_TOKEN:"89773db3-7863-460c-ad3c-6abd0db43f1c",API_URL:"https://vnavarra.nuvolaris.dev/api/my/assistant/doc_assistant",profileClass:e(".profile-class"),widgetElement:e(".widget"),btnClose:t("close"),btnChat:t("chat-button"),btnSend:t("sendButton"),userInpuId:t("userInput"),userInpuclass:e(".usrInput"),getChatClass:e(".chats"),getChatId:t("chats"),responseSuffix:'</p><div class="clearfix"></div>'},i={chatIcon:'\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon">\n            <path d="M2 15V5c0-1.1.9-2 2-2h16a2 2 0 0 1 2 2v15a1 1 0 0 1-1.7.7L16.58 17H4a2 2 0 0 1-2-2z"/>\n            <path  d="M6 7h12a1 1 0 0 1 0 2H6a1 1 0 1 1 0-2zm0 4h8a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2z"/>\n        </svg>\n    ',closeIcon:'\n        <svg xmlns="http://www.w3.org/2000/svg" style="display: block; margin: auto; transform: scale(1.5, 1.5);" viewBox="0 0 24 24" class="icon">\n            <path transform="translate(0.5,0)" fill-rule="evenodd" d="M15.78 14.36a1 1 0 0 1-1.42 1.42l-2.82-2.83-2.83 2.83a1 1 0 1 1-1.42-1.42l2.83-2.82L7.3 8.7a1 1 0 0 1 1.42-1.42l2.83 2.83 2.82-2.83a1 1 0 0 1 1.42 1.42l-2.83 2.83 2.83 2.82z"/>\n        </svg>\n    ',botImg:'<svg stroke="none" fill="black" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"></path></svg>',userImg:'<svg stroke="none" fill="black" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"></path></svg>'};var a=o(71),r=function(t,e,o,n){return new(o||(o=Promise))((function(s,i){function a(t){try{d(n.next(t))}catch(t){i(t)}}function r(t){try{d(n.throw(t))}catch(t){i(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,r)}d((n=n.apply(t,e||[])).next())}))};function d(){class t extends HTMLElement{constructor(){super(),this.isOpen=!1,this.attachShadow({mode:"open"}),this.isOpen=!1,this.messages=[],this.thinkingTimeout=null,this.apiPending=!1,this.totalTokens=0,this.styles=""}get _shadowRoot(){return this.shadowRoot}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n          <style>${a.A}</style>\n          <button class="toggle-chat-btn">${this.isOpen?i.closeIcon:i.chatIcon}</button>\n          <div class="chat-window" style="display: ${this.isOpen?"flex":"none"};">\n            <div class="chat_header">\n              \x3c!--Add the name of the bot here --\x3e\n              <span class="chat_header_title">${s.TITLE}</span>\n              <span id="close-btn">\n                <i class="fa fa-times-circle" aria-hidden="true"></i>\n              </span>\n            </div>\n            <button class="close-btn">Ã—</button>\n            <div class="chat-log" id="chats">\n              <div class="clearfix"></div>\n              ${this.messages.map((t=>`<div class="message ${t.role}">${t.content}</div>`)).join("")}\n            </div>\n            <div class="chat-input">\n                <input type="text" placeholder="Type a message...">\n                <button class="send-btn" ${this.apiPending?"disabled":""}>Send</button>\n              </div>\n            </div>\n        `)}clearAndFocusInput(t){t.value="",t.focus()}connectedCallback(){console.log("connected callback"),this.render(),this.addEventListeners()}disconnectedCallback(){this.thinkingTimeout&&clearTimeout(this.thinkingTimeout)}estimateTokens(t){return t.split(/\s+/).length+s.SPECIAL_TOKEN_BUFFER}handleCloseButtonClick(t){t.stopPropagation(),this.toggleChat()}handleInputKeydown(t){const e=t.target;"Enter"===t.key&&e.value.trim()&&(this.sendMessage(e.value.trim()),this.clearAndFocusInput(e))}handleSendButtonClick(){const t=this._shadowRoot.querySelector(".chat-input input");t.value.trim()&&(this.sendMessage(t.value.trim()),this.clearAndFocusInput(t))}handleToggleChatClick(t){t.stopPropagation(),this.toggleChat()}sendMessage(t){return r(this,void 0,void 0,(function*(){console.log("send function"),this.messages.push({role:"user",content:t}),this.render(),this.addEventListeners();const e={role:"assistant-thinking",content:"thinking..."};this.messages.push(e),this.render(),this.addEventListeners(),this.apiPending=!0,this.updateSendButtonState();const o=this._shadowRoot.querySelector(".chat-log");o&&(o.scrollTop=o.scrollHeight),this.thinkingTimeout=setTimeout((()=>r(this,void 0,void 0,(function*(){this.messages=this.messages.filter((t=>t!==e))}))),1e3);const n="Bearer "+s.YOUR_TOKEN;t||(t="");try{const e=yield fetch(s.API_URL,{method:"POST",headers:{Authorization:n,"Content-Type":"application/json"},body:JSON.stringify({input:t})});if(!e.ok)throw new Error("Network response failed");const o=yield e.json();this.totalTokens+=this.estimateTokens(o.output||"Sorry, I didn't understand that."),this.messages.push({role:"assistant",content:o.output||"Sorry, I didn't understand that."}),console.log("Response from OpenAi: "+o.output),this.setBotResponse(o.output)}catch(t){console.error("There was a problem with the fetch operation:",t),this.messages.push({role:"assistant",content:"Sorry, there was an error processing your message."})}for(;this.totalTokens>s.TOKEN_LIMIT&&this.messages.length>0;){const t=this.messages.shift();this.totalTokens-=this.estimateTokens(t.content)}this.apiPending=!1,this.render(),this.addEventListeners()}))}setBotResponse(t){console.log(this.messages)}setUserResponse(t){console.log("preparing userInput Response");let e=document.createElement("div");const o='<div class="userAvatar">'+i.userImg+'</div><p class="userMsg">';e.className="msgUser",e.innerHTML=o+t+s.responseSuffix,e&&(this._shadowRoot.querySelector(".chats").appendChild(e).style.display="block"),this.render(),this.addEventListeners()}toggleChat(){this.isOpen=!this.isOpen,this.render(),this.addEventListeners()}updateSendButtonState(){const t=this._shadowRoot.querySelector(".send-btn");this.apiPending?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}addEventListeners(){this.shadowRoot&&(this._shadowRoot.querySelector(".toggle-chat-btn").addEventListener("click",this.handleToggleChatClick.bind(this)),this._shadowRoot.querySelector(".close-btn").addEventListener("click",this.handleCloseButtonClick.bind(this)),this._shadowRoot.querySelector(".send-btn").addEventListener("click",this.handleSendButtonClick.bind(this)),this._shadowRoot.querySelector(".chat-input input").addEventListener("keydown",this.handleInputKeydown.bind(this)))}}customElements.get("chat-bot")||(console.log("customElement defined"),customElements.define("chat-bot",t))}d()})(),n.default})()));